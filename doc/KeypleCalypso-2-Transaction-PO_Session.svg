<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="709px" preserveAspectRatio="none" style="width:1000px;height:709px;" version="1.1" viewBox="0 0 1000 709" width="1000px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cpkcef705r5n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[474a687950c0c91cb5d6698c98d55883]
cluster org.keyple.calypso.transaction--><polygon fill="#FFFFFF" filter="url(#f1cpkcef705r5n)" points="22,24,271,24,278,46.2969,978,46.2969,978,697,22,697,22,24" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="278" y1="46.2969" y2="46.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="26" y="38.9951">org.keyple.calypso.transaction</text><!--MD5=[e8e21ba3995782366e9aa9ad2c6b2d5f]
class PoResource--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="60.8047" id="PoResource" style="stroke: #A80036; stroke-width: 1.5;" width="346" x="124" y="59"/><ellipse cx="232.25" cy="75" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M234.5938,70.6719 L234.7656,70.75 C234.9844,70.4375 235.1875,70.3438 235.4844,70.3438 C235.7813,70.3438 236.0625,70.4844 236.2188,70.75 C236.3125,70.9063 236.3281,71.0313 236.3281,71.4688 L236.3281,72.8906 C236.3281,73.3125 236.2969,73.5 236.1875,73.6563 C236.0156,73.875 235.75,74.0156 235.4844,74.0156 C235.2656,74.0156 235.0313,73.9063 234.8906,73.7656 C234.75,73.6406 234.7188,73.5156 234.6563,73.1094 C234.5625,72.7031 234.3906,72.4844 233.9063,72.2031 C233.4375,71.9531 232.8281,71.7969 232.25,71.7969 C230.5156,71.7969 229.2656,73.1094 229.2656,74.8906 L229.2656,75.9844 C229.2656,77.6875 230.5625,78.7813 232.6094,78.7813 C233.375,78.7813 234.0625,78.6563 234.4844,78.3906 C234.6719,78.2969 234.6719,78.2969 235.125,77.8125 C235.3125,77.625 235.5156,77.5469 235.7344,77.5469 C236.2031,77.5469 236.5938,77.9375 236.5938,78.3906 C236.5938,78.7813 236.2656,79.2344 235.6875,79.6406 C234.9375,80.1875 233.7813,80.4844 232.5625,80.4844 C229.6719,80.4844 227.5625,78.5938 227.5625,76.0156 L227.5625,74.8906 C227.5625,72.1719 229.5625,70.0938 232.1875,70.0938 C233.0625,70.0938 233.6563,70.2344 234.5938,70.6719 Z "/><ellipse cx="257.75" cy="74.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="263.75" y="79.1543">final</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="298.75" y="79.1543">PoResource</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="125" x2="469" y1="91" y2="91"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="125" x2="469" y1="99" y2="99"/><ellipse cx="135" cy="110" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="320" x="144" y="113.2104">PoResource(SeReader seReader, CalypsoPo calypsoPo);</text><!--MD5=[43918d86839edc1befb88ea50efcfbfb]
class SamResource--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="60.8047" id="SamResource" style="stroke: #A80036; stroke-width: 1.5;" width="370" x="505" y="59"/><ellipse cx="619.75" cy="75" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M622.0938,70.6719 L622.2656,70.75 C622.4844,70.4375 622.6875,70.3438 622.9844,70.3438 C623.2813,70.3438 623.5625,70.4844 623.7188,70.75 C623.8125,70.9063 623.8281,71.0313 623.8281,71.4688 L623.8281,72.8906 C623.8281,73.3125 623.7969,73.5 623.6875,73.6563 C623.5156,73.875 623.25,74.0156 622.9844,74.0156 C622.7656,74.0156 622.5313,73.9063 622.3906,73.7656 C622.25,73.6406 622.2188,73.5156 622.1563,73.1094 C622.0625,72.7031 621.8906,72.4844 621.4063,72.2031 C620.9375,71.9531 620.3281,71.7969 619.75,71.7969 C618.0156,71.7969 616.7656,73.1094 616.7656,74.8906 L616.7656,75.9844 C616.7656,77.6875 618.0625,78.7813 620.1094,78.7813 C620.875,78.7813 621.5625,78.6563 621.9844,78.3906 C622.1719,78.2969 622.1719,78.2969 622.625,77.8125 C622.8125,77.625 623.0156,77.5469 623.2344,77.5469 C623.7031,77.5469 624.0938,77.9375 624.0938,78.3906 C624.0938,78.7813 623.7656,79.2344 623.1875,79.6406 C622.4375,80.1875 621.2813,80.4844 620.0625,80.4844 C617.1719,80.4844 615.0625,78.5938 615.0625,76.0156 L615.0625,74.8906 C615.0625,72.1719 617.0625,70.0938 619.6875,70.0938 C620.5625,70.0938 621.1563,70.2344 622.0938,70.6719 Z "/><ellipse cx="645.25" cy="74.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="651.25" y="79.1543">final</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="686.25" y="79.1543">SamResource</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="506" x2="874" y1="91" y2="91"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="506" x2="874" y1="99" y2="99"/><ellipse cx="516" cy="110" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="344" x="525" y="113.2104">PoResource(SeReader seReader, CalypsoSam calypsoSam);</text><!--MD5=[8eb5cec01ad571a9feeff1db4f73a667]
class PoTransaction--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="355.3125" id="PoTransaction" style="stroke: #A80036; stroke-width: 1.5;" width="924" x="38" y="180"/><ellipse cx="427.75" cy="196" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M430.0938,191.6719 L430.2656,191.75 C430.4844,191.4375 430.6875,191.3438 430.9844,191.3438 C431.2813,191.3438 431.5625,191.4844 431.7188,191.75 C431.8125,191.9063 431.8281,192.0313 431.8281,192.4688 L431.8281,193.8906 C431.8281,194.3125 431.7969,194.5 431.6875,194.6563 C431.5156,194.875 431.25,195.0156 430.9844,195.0156 C430.7656,195.0156 430.5313,194.9063 430.3906,194.7656 C430.25,194.6406 430.2188,194.5156 430.1563,194.1094 C430.0625,193.7031 429.8906,193.4844 429.4063,193.2031 C428.9375,192.9531 428.3281,192.7969 427.75,192.7969 C426.0156,192.7969 424.7656,194.1094 424.7656,195.8906 L424.7656,196.9844 C424.7656,198.6875 426.0625,199.7813 428.1094,199.7813 C428.875,199.7813 429.5625,199.6563 429.9844,199.3906 C430.1719,199.2969 430.1719,199.2969 430.625,198.8125 C430.8125,198.625 431.0156,198.5469 431.2344,198.5469 C431.7031,198.5469 432.0938,198.9375 432.0938,199.3906 C432.0938,199.7813 431.7656,200.2344 431.1875,200.6406 C430.4375,201.1875 429.2813,201.4844 428.0625,201.4844 C425.1719,201.4844 423.0625,199.5938 423.0625,197.0156 L423.0625,195.8906 C423.0625,193.1719 425.0625,191.0938 427.6875,191.0938 C428.5625,191.0938 429.1563,191.2344 430.0938,191.6719 Z "/><ellipse cx="453.25" cy="195.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="459.25" y="200.1543">final</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="90" x="494.25" y="200.1543">PoTransaction</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="961" y1="212" y2="212"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="961" y1="220" y2="220"/><ellipse cx="49" cy="231" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="653" x="58" y="234.2104">PoTransaction(PoResource poResource, SamResource[0..1] samResource, SecuritySettings[0..1] securitySettings)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="247.0151"/><ellipse cx="49" cy="256.6094" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="308" x="58" y="259.8198">int prepareSelectFileCmd(byte[] path, String extraInfo)</text><ellipse cx="49" cy="269.4141" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="514" x="58" y="272.6245">int prepareSelectFileCmd(SelectFileCmdBuild.SelectControl selectControl, String extraInfo)</text><ellipse cx="49" cy="282.2188" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="823" x="58" y="285.4292">int prepareReadRecordsCmd(byte sfi, ReadDataStructure readDataStructureEnum, byte firstRecordNumber, int expectedLength, String extraInfo)</text><ellipse cx="49" cy="295.0234" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="708" x="58" y="298.2339">int prepareReadRecordsCmd(byte sfi, ReadDataStructure readDataStructureEnum, byte firstRecordNumber, String extraInfo)</text><ellipse cx="49" cy="307.8281" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="448" x="58" y="311.0386">int prepareAppendRecordCmd(byte sfi, byte[] newRecordData, String extraInfo)</text><ellipse cx="49" cy="320.6328" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="564" x="58" y="323.8433">int prepareUpdateRecordCmd(byte sfi, byte recordNumber, byte[] newRecordData, String extraInfo)</text><ellipse cx="49" cy="333.4375" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="481" x="58" y="336.6479">int prepareIncreaseCmd(byte sfi, byte counterNumber, int incValue, String extraInfo)</text><ellipse cx="49" cy="346.2422" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="490" x="58" y="349.4526">int prepareDecreaseCmd(byte sfi, byte counterNumber, int decValue, String extraInfo)</text><ellipse cx="49" cy="359.0469" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="397" x="58" y="362.2573">AbstractApduResponseParser getResponseParser(int commandIndex)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="375.062"/><ellipse cx="49" cy="384.6563" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="898" x="58" y="387.8667">boolean processOpening(ModificationMode modificationMode, SessionAccessLevel accessLevel, byte openingSfiToSelect, byte openingRecordNumberToRead)</text><ellipse cx="49" cy="397.4609" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="185" x="58" y="400.6714">byte[] getOpenRecordDataRead()</text><ellipse cx="49" cy="410.2656" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="58" y="413.4761">boolean wasRatified()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="426.2808"/><ellipse cx="49" cy="435.875" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="336" x="58" y="439.0854">boolean processPoCommands(ChannelState channelState)</text><ellipse cx="49" cy="448.6797" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="238" x="58" y="451.8901">boolean processPoCommandsInSession()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="464.6948"/><ellipse cx="49" cy="474.2891" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="299" x="58" y="477.4995">boolean processClosing(ChannelState channelState)</text><ellipse cx="49" cy="487.0938" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="129" x="58" y="490.3042">boolean isSuccessful()</text><ellipse cx="49" cy="499.8984" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="295" x="58" y="503.1089">boolean processCancel(ChannelState channelState)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="515.9136"/><ellipse cx="49" cy="525.5078" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="476" x="58" y="528.7183">SeResponse processSamCommands(List&lt;SamBuilderParser&gt; samBuilderParsers)</text><!--MD5=[2242c43c330acc437358859ea7f59776]
class SessionState--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="86.4141" id="SessionState" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="198" y="595"/><ellipse cx="220.2" cy="611" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M218.4969,611.875 L218.4969,614.2969 L222.8563,614.2969 L222.8563,613.4219 C222.8563,612.9375 222.8875,612.7969 222.9969,612.6406 C223.1688,612.3906 223.4344,612.2813 223.7,612.2813 C223.9813,612.2813 224.2625,612.4375 224.4344,612.6875 C224.5125,612.8438 224.5438,612.9844 224.5438,613.4219 L224.5438,616 L216.5438,616 C216.1531,616 215.9188,615.9531 215.7781,615.8281 C215.5594,615.6719 215.4188,615.4219 215.4188,615.1563 C215.4188,614.8594 215.575,614.5938 215.825,614.4219 C215.9813,614.3125 216.1375,614.2969 216.5438,614.2969 L216.7938,614.2969 L216.7938,607.7813 L216.5438,607.7813 C216.1219,607.7813 215.9344,607.75 215.7781,607.6406 C215.5594,607.4688 215.4188,607.2188 215.4188,606.9375 C215.4188,606.6563 215.575,606.3594 215.825,606.2031 C215.9813,606.1094 216.1063,606.0938 216.5438,606.0938 L224.1688,606.0938 L224.1688,608.6406 C224.1688,609.1094 224.1375,609.25 224.0281,609.4219 C223.8563,609.6406 223.5906,609.7813 223.325,609.7813 C223.0438,609.7813 222.7625,609.625 222.5906,609.375 C222.5125,609.2188 222.4813,609.0469 222.4813,608.6406 L222.4813,607.7813 L218.4969,607.7813 L218.4969,610.1875 L219.95,610.1875 L219.95,610.0625 C219.95,609.6094 219.9813,609.4531 220.0906,609.2813 C220.2625,609.0625 220.5281,608.9219 220.7781,608.9219 C221.2313,608.9219 221.5438,609.2344 221.6063,609.7031 C221.6219,609.8594 221.6219,609.9063 221.6219,610.0625 L221.6219,611.9844 C221.6219,612.4375 221.5906,612.5938 221.4656,612.75 C221.3094,612.9688 221.0438,613.1094 220.7938,613.1094 C220.4969,613.1094 220.2156,612.9531 220.0594,612.7031 C219.9813,612.5469 219.95,612.3906 219.95,611.9844 L219.95,611.875 Z "/><ellipse cx="240.8" cy="610.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="83" x="246.8" y="615.1543">SessionState</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="199" x2="339" y1="627" y2="627"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="130" x="204" y="641.2104">SESSION_UNITIALIZED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="92" x="204" y="654.0151">SESSION_OPEN,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="204" y="666.8198">SESSION_CLOSED</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="199" x2="339" y1="673.4141" y2="673.4141"/><!--MD5=[725363c15b2fca4588eaca0d2be2b1de]
class SessionAccessLevel--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="86.4141" id="SessionAccessLevel" style="stroke: #A80036; stroke-width: 1.5;" width="250" x="375" y="595"/><ellipse cx="428.25" cy="611" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M426.5469,611.875 L426.5469,614.2969 L430.9063,614.2969 L430.9063,613.4219 C430.9063,612.9375 430.9375,612.7969 431.0469,612.6406 C431.2188,612.3906 431.4844,612.2813 431.75,612.2813 C432.0313,612.2813 432.3125,612.4375 432.4844,612.6875 C432.5625,612.8438 432.5938,612.9844 432.5938,613.4219 L432.5938,616 L424.5938,616 C424.2031,616 423.9688,615.9531 423.8281,615.8281 C423.6094,615.6719 423.4688,615.4219 423.4688,615.1563 C423.4688,614.8594 423.625,614.5938 423.875,614.4219 C424.0313,614.3125 424.1875,614.2969 424.5938,614.2969 L424.8438,614.2969 L424.8438,607.7813 L424.5938,607.7813 C424.1719,607.7813 423.9844,607.75 423.8281,607.6406 C423.6094,607.4688 423.4688,607.2188 423.4688,606.9375 C423.4688,606.6563 423.625,606.3594 423.875,606.2031 C424.0313,606.1094 424.1563,606.0938 424.5938,606.0938 L432.2188,606.0938 L432.2188,608.6406 C432.2188,609.1094 432.1875,609.25 432.0781,609.4219 C431.9063,609.6406 431.6406,609.7813 431.375,609.7813 C431.0938,609.7813 430.8125,609.625 430.6406,609.375 C430.5625,609.2188 430.5313,609.0469 430.5313,608.6406 L430.5313,607.7813 L426.5469,607.7813 L426.5469,610.1875 L428,610.1875 L428,610.0625 C428,609.6094 428.0313,609.4531 428.1406,609.2813 C428.3125,609.0625 428.5781,608.9219 428.8281,608.9219 C429.2813,608.9219 429.5938,609.2344 429.6563,609.7031 C429.6719,609.8594 429.6719,609.9063 429.6719,610.0625 L429.6719,611.9844 C429.6719,612.4375 429.6406,612.5938 429.5156,612.75 C429.3594,612.9688 429.0938,613.1094 428.8438,613.1094 C428.5469,613.1094 428.2656,612.9531 428.1094,612.7031 C428.0313,612.5469 428,612.3906 428,611.9844 L428,611.875 Z "/><ellipse cx="453.75" cy="610.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="459.75" y="615.1543">SessionAccessLevel</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="376" x2="624" y1="627" y2="627"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="376" x2="624" y1="635" y2="635"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="238" x="381" y="649.2104">SESSION_LVL_PERSO("perso", byte 0x01),</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="221" x="381" y="662.0151">SESSION_LVL_LOAD("load", byte 0x02),</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="224" x="381" y="674.8198">SESSION_LVL_DEBIT("debit", byte 0x03)</text><!--MD5=[e19a48d2c11a8f9a6a11f4ef9a7d8d18]
class ModificationMode--><rect fill="#FEFECE" filter="url(#f1cpkcef705r5n)" height="73.6094" id="ModificationMode" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="660" y="601"/><ellipse cx="675" cy="617" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M673.2969,617.875 L673.2969,620.2969 L677.6563,620.2969 L677.6563,619.4219 C677.6563,618.9375 677.6875,618.7969 677.7969,618.6406 C677.9688,618.3906 678.2344,618.2813 678.5,618.2813 C678.7813,618.2813 679.0625,618.4375 679.2344,618.6875 C679.3125,618.8438 679.3438,618.9844 679.3438,619.4219 L679.3438,622 L671.3438,622 C670.9531,622 670.7188,621.9531 670.5781,621.8281 C670.3594,621.6719 670.2188,621.4219 670.2188,621.1563 C670.2188,620.8594 670.375,620.5938 670.625,620.4219 C670.7813,620.3125 670.9375,620.2969 671.3438,620.2969 L671.5938,620.2969 L671.5938,613.7813 L671.3438,613.7813 C670.9219,613.7813 670.7344,613.75 670.5781,613.6406 C670.3594,613.4688 670.2188,613.2188 670.2188,612.9375 C670.2188,612.6563 670.375,612.3594 670.625,612.2031 C670.7813,612.1094 670.9063,612.0938 671.3438,612.0938 L678.9688,612.0938 L678.9688,614.6406 C678.9688,615.1094 678.9375,615.25 678.8281,615.4219 C678.6563,615.6406 678.3906,615.7813 678.125,615.7813 C677.8438,615.7813 677.5625,615.625 677.3906,615.375 C677.3125,615.2188 677.2813,615.0469 677.2813,614.6406 L677.2813,613.7813 L673.2969,613.7813 L673.2969,616.1875 L674.75,616.1875 L674.75,616.0625 C674.75,615.6094 674.7813,615.4531 674.8906,615.2813 C675.0625,615.0625 675.3281,614.9219 675.5781,614.9219 C676.0313,614.9219 676.3438,615.2344 676.4063,615.7031 C676.4219,615.8594 676.4219,615.9063 676.4219,616.0625 L676.4219,617.9844 C676.4219,618.4375 676.3906,618.5938 676.2656,618.75 C676.1094,618.9688 675.8438,619.1094 675.5938,619.1094 C675.2969,619.1094 675.0156,618.9531 674.8594,618.7031 C674.7813,618.5469 674.75,618.3906 674.75,617.9844 L674.75,617.875 Z "/><ellipse cx="694" cy="616.5" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="700" y="621.1543">ModificationMode</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="661" x2="811" y1="633" y2="633"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="47" x="666" y="647.2104">ATOMIC,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="53" x="666" y="660.0151">MULTIPLE</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="661" x2="811" y1="666.6094" y2="666.6094"/><!--MD5=[4fae7473818f03b79e7e0ec0aa516fd0]
link PoResource to SamResource--><!--MD5=[e4e6b0c197a4fe408c8d4c7214bc9356]
link PoResource to PoTransaction--><path d="M319.696,120.239 C329.909,133.623 342.887,150.628 357.184,169.362 " fill="none" id="PoResource-&gt;PoTransaction" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="365.253,179.935,364.7926,172.7386,357.9727,170.3958,358.4331,177.5922,365.253,179.935" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="315.3768" y="139.8665">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="351.3996" y="169.1907">1</text><!--MD5=[81ec7bb0193646d0b634332c5a6f933e]
link SamResource to PoTransaction--><path d="M668.758,120.239 C659.242,133.561 647.164,150.471 633.856,169.102 " fill="none" id="SamResource-&gt;PoTransaction" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="626.118,179.935,632.8603,177.3774,633.0926,170.17,626.3503,172.7276,626.118,179.935" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="638.2135" y="139.8665">0..1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="623.2699" y="169.1907">1</text><!--MD5=[4e36a4e3a201b7955d2f14bdee0043a9]
reverse link PoTransaction to SessionState--><path d="M331.466,547.213 C317.536,564.667 304.896,580.928 294.634,594.685 " fill="none" id="PoTransaction&lt;-SessionState" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="336.0416" cy="541.5129" fill="#FFFFFF" rx="8" ry="8" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="331.0352" x2="341.048" y1="547.7528" y2="535.273"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="329.8017" x2="342.2815" y1="536.5065" y2="546.5193"/><!--MD5=[4e36a4e3a201b7955d2f14bdee0043a9]
reverse link PoTransaction to SessionState--><path d="M357.917,545.204 C342.234,563.418 327.228,580.402 314.118,594.685 " fill="none" id="PoTransaction&lt;-SessionState-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="366.431,535.273,359.4889,537.2243,358.6201,544.3829,365.5622,542.4316,366.431,535.273" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[a4585e013431eb8b4a0cfd6b9add47a8]
reverse link PoTransaction to SessionAccessLevel--><path d="M488.099,550.456 C488.647,566.68 489.459,581.784 490.537,594.685 " fill="none" id="PoTransaction&lt;-SessionAccessLevel" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="487.8965" cy="543.2698" fill="#FFFFFF" rx="8" ry="8" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="488.122" x2="487.671" y1="551.2666" y2="535.273"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479.8997" x2="495.8933" y1="543.4953" y2="543.0443"/><!--MD5=[a4585e013431eb8b4a0cfd6b9add47a8]
reverse link PoTransaction to SessionAccessLevel--><path d="M512.671,548.464 C512.091,565.443 511.207,581.258 510.02,594.685 " fill="none" id="PoTransaction&lt;-SessionAccessLevel-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="513.055,535.273,508.882,541.154,512.7055,547.2679,516.8786,541.3869,513.055,535.273" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[5c41e0e7e04d6347ef08cb45d9bc378b]
reverse link PoTransaction to ModificationMode--><path d="M647.49,546.737 C665.375,567.099 682.312,585.859 696.539,600.94 " fill="none" id="PoTransaction&lt;-ModificationMode" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="642.7325" cy="541.2958" fill="#FFFFFF" rx="8" ry="8" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="647.998" x2="637.467" y1="547.3187" y2="535.273"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636.7097" x2="648.7553" y1="546.5613" y2="536.0303"/><!--MD5=[5c41e0e7e04d6347ef08cb45d9bc378b]
reverse link PoTransaction to ModificationMode--><path d="M671.316,545.604 C688.277,566.403 703.416,585.58 714.87,600.94 " fill="none" id="PoTransaction&lt;-ModificationMode-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="662.851,535.273,663.5594,542.4492,670.456,544.5554,669.7477,537.3792,662.851,535.273" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[28766d74b9ea15b3b5dc175a0f47b55b]
@startuml
package org.keyple.calypso.transaction #FFFFFF {

+class "<b>final</b> PoResource" as PoResource {
	+PoResource(SeReader seReader, CalypsoPo calypsoPo);
}

+class "<b>final</b> SamResource" as SamResource {
	+PoResource(SeReader seReader, CalypsoSam calypsoSam);
}

+class "<b>final</b> PoTransaction" as PoTransaction {
	+PoTransaction(PoResource poResource, SamResource[0..1] samResource, SecuritySettings[0..1] securitySettings)

	+int prepareSelectFileCmd(byte[] path, String extraInfo)
	+int prepareSelectFileCmd(SelectFileCmdBuild.SelectControl selectControl, String extraInfo)
	+int prepareReadRecordsCmd(byte sfi, ReadDataStructure readDataStructureEnum, byte firstRecordNumber, int expectedLength, String extraInfo)
	+int prepareReadRecordsCmd(byte sfi, ReadDataStructure readDataStructureEnum, byte firstRecordNumber, String extraInfo)
	+int prepareAppendRecordCmd(byte sfi, byte[] newRecordData, String extraInfo)
	+int prepareUpdateRecordCmd(byte sfi, byte recordNumber, byte[] newRecordData, String extraInfo)
	+int prepareIncreaseCmd(byte sfi, byte counterNumber, int incValue, String extraInfo)
	+int prepareDecreaseCmd(byte sfi, byte counterNumber, int decValue, String extraInfo)
	+AbstractApduResponseParser getResponseParser(int commandIndex)

	+boolean processOpening(ModificationMode modificationMode, SessionAccessLevel accessLevel, byte openingSfiToSelect, byte openingRecordNumberToRead)
	+byte[] getOpenRecordDataRead()
	+boolean wasRatified()

	+boolean processPoCommands(ChannelState channelState)
	+boolean processPoCommandsInSession()

	+boolean processClosing(ChannelState channelState)
	+boolean isSuccessful()
	+boolean processCancel(ChannelState channelState)

	+SeResponse processSamCommands(List<SamBuilderParser> samBuilderParsers)
}

+enum SessionState {
	SESSION_UNITIALIZED,
	SESSION_OPEN,
	SESSION_CLOSED
}

+enum SessionAccessLevel {
	SESSION_LVL_PERSO("perso", byte 0x01),
	SESSION_LVL_LOAD("load", byte 0x02),
	SESSION_LVL_DEBIT("debit", byte 0x03)
}

+enum ModificationMode {
	ATOMIC,
	MULTIPLE
}

PoResource -right[hidden]- SamResource
PoTransaction "1" *-up- "1" PoResource
PoTransaction "1" *-up- "0..1" SamResource

PoTransaction +-down- SessionState
PoTransaction *-down- SessionState
PoTransaction +-down- SessionAccessLevel
PoTransaction *-down- SessionAccessLevel
PoTransaction +-down- ModificationMode
PoTransaction *-down- ModificationMode
}
@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>